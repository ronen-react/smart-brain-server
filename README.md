# Deployed at:
https://infinite-badlands-96374.herokuapp.com/

# smart-brain-server
A project from udemy course - 'The Complete Web Developer in 2020: Zero to Mastery'
# Notes on postgres commands
#login as psql:
sudo -u postgres psql
#login as ronen:

# create user:
sudo -u postgres createuser --interactive
and then it opens:
Enter name of role to add: ronen
Shall the new role be a superuser? (y/n) y

ALTER USER ronen WITH ENCRYPTED PASSWORD 'password';

# create db:
createdb test

# launch:
psql database-name 
e.g:
psql smart-brain
etc


# delete database:
DROP DATABASE testdb1;



create table:
CREATE TABLE users (name text, age smallint, birthday date);


#list tables:
\d


# insert:
INSERT INTO users (name, age, birthday) VALUES('Andrei', 31, '1930-01-025');

# show columns:
SELECT name, age, birthday FROM users;

# show all columns:
SELECT * FROM users;

# add a new column:
ALTER TABLE users ADD score smallint;

# update table:
UPDATE table_name 
SET some_column = some_Value 
WHERE some_column = some_value

UPDATE users S
ET score = 50 
WHERE name = 'Andrei';


# Grab all users with naems start with a and % which means anything after a:

SELECT * FROM users WHERE name LIKE 'A%';

# Names endin with y:
SELECT * FROM users WHERE name LIKE '%y';

# sort descending::
SELECT * FROM users ORDER BY score DESC;

# sort ascending::
SELECT * FROM users ORDER BY score ASC;



# AVERAGE score of users:
SELECT AVG(score) FROM users;

# sum
SELECT SUM(age) FROM users;

#count
SELECT SUM(age) FROM users;

# CREATE TABLE:
CREATE TABLE login (
	ID serial NOT NULL PRIMARY KEY,
	secret VARCHAR (100) NOT NULL,
	name text UNIQUE NOT NULL
);

INSERT INTO login (
	secret, name) VALUES('abc', 'Andrei')
)


# Joining tables:
SELECT * FROM users JOIN login ON users.name = login.name;

Delete

DELETE FROM users WHERE name='Andrei' AND score is NULL;

# Delete table:

DROP TABLE users;



######### project:
createdb 'smart-brain'




# Notes on deploy to Heroku
### Ref:
https://devcenter.heroku.com/articles/getting-started-with-nodejs#set-up
## Install Heroku cli:
```sudo snap install heroku --classic
```
## Heroku login:
```heroku login
```

## Deploy the app - assumed local app is in git

```
heroku create
```

Mow a git remote called hroku is created and associated with local repository.

## Now deploy the code:
```
git push heroku master
```

Now application is deployed. Ensure that at least one instance of the application is running:
```
heroku ps:scale web=1
```
## Now visit the app at the URL generated by its app name. As a handy shortcut, you can open the website as follows:
```
heroku open
```


## Can fetvh logs:
```
heroku logs
```



# Setup Postgress:

## Click 9*9 dot matrix on Heroku screen's upper right corner
### select Data
### install postgress, attach to application
### Now foloow documnetation: 
On terminal: 
$ heroku addons
$ heroku pg:psql
 Now database opens. Now create tables - paste the 2 tables' setup to terminal :

CREATE TABLE login (
	id serial PRIMARY KEY,
	hash VARCHAR(100) NOT NULL,
	email text UNIQUE NOT NULL
);

CREATE TABLE users (
	id serial PRIMARY KEY,
	name VARCHAR(100),
	email text UNIQUE NOT NULL,
	entries BIGINT DEFAULT 0,
	joined TIMESTAMP NOT NULL
);
=> See 'CREATE TABLE' printed on insertion success.


exit DATABASE: \q

 What is the url of database?
 Can be found if run on terminal:

 $heroku addon (could also run heoku pg:info and see address of add-on)

 result:
 dd-on                                             Plan       Price  State  
─────────────────────────────────────────────────  ─────────  ─────  ───────
heroku-postgresql (postgresql-asymmetrical-16745)  hobby-dev  free   created
 └─ as DATABASE

The table above shows add-ons and the attachments to the current app (infinite-badlands-96374) or other apps.

So url is  is postgresql-asymmetrical-16745

Set url to server.js in db configuration/ (replace local 127.0.0.1)

commit the changes
push changes to heroku master.

-> change the database connection parameters to:
const db = knex({  client: 'pg',
  connection: {
  	host: process.env.DATABASE_URL,
  	ssl: true,
    // host : '127.0.0.1',
    // host : 'postgresql-asymmetrical-16745'
    // user : 'ronen',
    // password : 'password',
    // database : 'smart-brain'
  }
});


push changes to heroku master

(it still doesn't work..)
run:
heroku config

It gives database url, 

go to logs:
heroku logs -tail